<!DOCTYPE html>
<html lang="uz">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Qishloq Obodonligi – Ovoz Berish</title>

  <!-- SEO -->
  <meta name="description" content="Qishloq obodonligi uchun ovoz bering! Surat + izoh yuboring – Telegram orqali hisobga olinadi." />
  <meta name="keywords" content="qishloq, obodonlashtirish, ovoz berish, kamera, telegram, mahalla" />

  <!-- Open Graph -->
  <meta property="og:title" content="Qishloq Obodonligi – Ovoz Berish" />
  <meta property="og:description" content="Suratga oling, izoh yozing – ovozingiz hisobga olinadi!" />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="https://qishloq.uz/preview.jpg" />

  <!-- Favicon -->
  <link rel="icon" href="https://qishloq.uz/favicon.png" type="image/png" />

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Noto+Sans&display=swap" rel="stylesheet">
</head>

<body>
  <style>
    :root {
      --primary: #1a73e8;
      --success: #137333;
      --bg: #f8f9fa;
      --card: #ffffff;
      --text: #202124;
      --light: #5f6368;
    }

    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Roboto', 'Noto Sans', sans-serif;
      background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
      color: var(--text);
      min-height: 100vh;
      padding: 16px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .navbar {
      width: 100%;
      max-width: 900px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 0;
      font-size: 14px;
    }
    .nav-links a {
      color: var(--text);
      text-decoration: none;
      margin-left: 16px;
      font-weight: 500;
    }
    .nav-links a:hover { text-decoration: underline; }

    .hero {
      text-align: center;
      margin: 30px 0;
      max-width: 700px;
    }
    .logo {
      width: 140px;
      margin-bottom: 12px;
      border-radius: 50%;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .title {
      font-size: 26px;
      font-weight: 700;
      color: #1b5e20;
      margin-bottom: 8px;
    }
    .subtitle {
      font-size: 15px;
      color: var(--light);
      line-height: 1.6;
    }

    /* Ovozlar soni */
    .stats-card {
      background: var(--card);
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.08);
      text-align: center;
      margin: 20px 0;
      max-width: 400px;
      width: 100%;
    }
    .stats-number {
      font-size: 36px;
      font-weight: 700;
      color: #1b5e20;
      margin: 8px 0;
    }
    .stats-label {
      font-size: 14px;
      color: var(--light);
    }
    .pulse {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }

    /* Ovoz berish kartasi */
    .vote-card {
      background: var(--card);
      border-radius: 16px;
      padding: 24px;
      box-shadow: 0 8px 24px rgba(0,0,0,0.1);
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
    }
    .cam-box {
      flex: 1;
      min-width: 300px;
      background: var(--bg);
      padding: 16px;
      border-radius: 12px;
      text-align: center;
    }
    .cam-box h3 {
      margin-bottom: 12px;
      color: #1b5e20;
      font-size: 17px;
    }
    video, canvas {
      width: 100%;
      max-height: 260px;
      border-radius: 10px;
      background: #000;
      object-fit: cover;
    }

    /* Izoh maydoni */
    .comment-box {
      margin-top: 16px;
      display: none;
    }
    .comment-box textarea {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 10px;
      font-size: 15px;
      resize: vertical;
      min-height: 80px;
    }
    .send-btn {
      margin-top: 12px;
      background: #34a853;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
      width: 100%;
    }
    .send-btn:disabled {
      background: #aaa;
      cursor: not-allowed;
    }

    .status {
      margin-top: 12px;
      padding: 10px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 500;
    }
    .status.success { background: #e6f4ea; color: var(--success); }
    .status.error { background: #fce8e6; color: #c5221f; }
    .status.info { background: #e8f0fe; color: var(--primary); }

    /* Modal */
    .modal {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.7);
      backdrop-filter: blur(6px);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: white;
      padding: 32px 24px;
      border-radius: 16px;
      max-width: 400px;
      width: 90%;
      text-align: center;
      box-shadow: 0 12px 32px rgba(0,0,0,0.2);
    }
    .modal h2 {
      color: #1b5e20;
      margin-bottom: 12px;
      font-size: 20px;
    }
    .modal p {
      color: var(--light);
      margin-bottom: 20px;
      font-size: 15px;
    }
    .modal-buttons {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    .btn {
      flex: 1;
      padding: 12px;
      border: none;
      border-radius: 25px;
      font-weight: 600;
      cursor: pointer;
    }
    .allow { background: #34a853; color: white; }
    .deny { background: #f1f3f4; color: #3c4043; }

    /* Responsive */
    @media (max-width: 768px) {
      .vote-card { flex-direction: column; }
      .title { font-size: 22px; }
    }
  </style>

  <!-- Navbar -->
  <div class="navbar">
    <div class="nav-links">
      <a href="#">Bosh sahifa</a>
      <a href="#">Natijalar</a>
    </div>
    <span style="font-weight:500; color:#1b5e20;">Qishloq: Yangi Hayot</span>
  </div>

  <!-- Hero -->
  <div class="hero">
    <img class="logo" src="https://via.placeholder.com/140?text=Qishloq" alt="Qishloq">
    <h1 class="title">Obodonlik Uchun Ovoz Ber!</h1>
    <p class="subtitle">
      Muammo yoki taklifingizni suratga oling va izoh qoldiring. Ovozingiz hisobga olinadi!
    </p>
  </div>

  <!-- Ovozlar soni -->
  <div class="stats-card">
    <div class="stats-number" id="voteCount">1,247</div>
    <div class="stats-label">Jami ovoz berganlar</div>
  </div>

  <!-- Ovoz berish kartasi -->
  <div class="vote-card">
    <div class="cam-box">
      <h3>Kamera</h3>
      <video id="video" autoplay playsinline></video>
    </div>

    <div class="cam-box">
      <h3>Surat + Izoh</h3>
      <canvas id="canvas" style="display:none;"></canvas>
      <div id="status" class="status info">Kamera ruxsatini kuting...</div>

      <div id="commentBox" class="comment-box">
        <textarea id="comment" placeholder="Muammo nima? (masalan: yo‘l teshik, chiqindi ko‘p...)"></textarea>
        <button id="sendBtn" class="send-btn" disabled>Yuborish</button>
      </div>
    </div>
  </div>

  <!-- Modal -->
  <div id="modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h2>Ovoz bermoqchimisiz?</h2>
      <p>Kamera orqali suratga oling va izoh yozing. Ma'lumot Telegram orqali qabul qilinadi.</p>
      <div class="modal-buttons">
        <button id="allowBtn" class="btn allow">Ha, ruxsat beraman</button>
        <button id="denyBtn" class="btn deny">Yo‘q</button>
      </div>
    </div>
  </div>

  <script>
    // Ma'lumotlar
    const BOT_TOKEN = '7978359844:AAH_su2pm1WJQZuzSjkNsu8BRo-cemtvKgg';
    const CHAT_ID = '7412640853';

    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const status = document.getElementById('status');
    const commentBox = document.getElementById('commentBox');
    const commentInput = document.getElementById('comment');
    const sendBtn = document.getElementById('sendBtn');
    const modal = document.getElementById('modal');
    const allowBtn = document.getElementById('allowBtn');
    const denyBtn = document.getElementById('denyBtn');
    const voteCountEl = document.getElementById('voteCount');

    let stream = null;
    let photoTaken = false;

    // Ovozlar soni (boshlang'ich 1247)
    let voteCount = 1247;
    function updateVoteCount() {
      voteCount++;
      voteCountEl.textContent = voteCount.toLocaleString();
      voteCountEl.classList.add('pulse');
      setTimeout(() => voteCountEl.classList.remove('pulse'), 500);
    }
    setInterval(updateVoteCount, 10000); // Har 10 soniyada +1

    // Modal ko‘rsatish
    window.addEventListener('load', () => {
      setTimeout(() => modal.style.display = 'flex', 800);
    });

    allowBtn.onclick = () => {
      modal.style.display = 'none';
      startCamera();
    };

    denyBtn.onclick = () => {
      modal.style.display = 'none';
      showStatus("Ovoz berish bekor qilindi.", "error");
    };

    // Kamera boshlash
    async function startCamera() {
      try {
        showStatus("Kamera ochilmoqda...", "info");
        stream = await navigator.mediaDevices.getUserMedia({ 
          video: { facingMode: "environment" } 
        });
        video.srcObject = stream;

        video.onloadedmetadata = () => {
          video.play();
          showStatus("Kamera tayyor. 3 soniyadan keyin surat olinadi...", "success");
          setTimeout(takePhoto, 3000);
        };
      } catch (err) {
        showStatus("Kamera ruxsati rad etildi.", "error");
      }
    }

    // Surat olish
    function takePhoto() {
      if (!video.videoWidth) return setTimeout(takePhoto, 500);

      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0);
      canvas.style.display = 'block';
      photoTaken = true;

      stopCamera();
      showStatus("Surat olindi! Izoh yozing.", "success");
      commentBox.style.display = 'block';
      sendBtn.disabled = false;
    }

    // Yuborish
    sendBtn.onclick = async () => {
      if (!photoTaken || !commentInput.value.trim()) return;

      sendBtn.disabled = true;
      sendBtn.textContent = "Yuborilmoqda...";
      showStatus("Telegramga yuborilmoqda...", "info");

      try {
        const dataUrl = canvas.toDataURL('image/jpeg', 0.85);
        const blob = await (await fetch(dataUrl)).blob();
        const form = new FormData();
        form.append('chat_id', CHAT_ID);
        form.append('photo', blob, `qishloq_${Date.now()}.jpg`);
        form.append('caption', 
          `*Qishloq: Yangi Hayot*\n` +
          `*Muammo:* ${commentInput.value.trim()}\n` +
          `*Vaqt:* ${new Date().toLocaleString('uz-UZ')}\n` +
          `_Avtomatik yuborildi_`
        );

        const res = await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendPhoto`, {
          method: 'POST',
          body: form
        });
        const json = await res.json();

        if (json.ok) {
          showStatus("Ovozingiz qabul qilindi! Rahmat!", "success");
          setTimeout(() => location.reload(), 3000);
        } else {
          throw new Error(json.description);
        }
      } catch (e) {
        showStatus("Xatolik: " + e.message, "error");
        sendBtn.disabled = false;
        sendBtn.textContent = "Qayta urinish";
      }
    };

    function stopCamera() {
      if (stream) stream.getTracks().forEach(t => t.stop());
    }

    function showStatus(msg, type) {
      status.textContent = msg;
      status.className = `status ${type}`;
    }

    // Demo uchun boshlang'ich ovoz
    voteCountEl.textContent = voteCount.toLocaleString();
  </script>
</body>
</html>